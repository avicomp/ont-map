@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix owl:   <http://www.w3.org/2002/07/owl#> .
@prefix spin:  <http://spinrdf.org/spin#> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix spinmap: <http://spinrdf.org/spinmap#> .
@prefix sp:    <http://spinrdf.org/sp#> .
@prefix spl:   <http://spinrdf.org/spl#> .
@prefix avc:   <http://avc.ru/spin#> .

<http://avc.ru/spin>  a  owl:Ontology ;
        rdfs:comment     "This is an addition to the spin-family in order to customize spin-functions behaviour in GUI.\nAlso it contains several custom functions, which can be expressed through the other spin-library and SPARQL.\nCurrently it is assumed that this library is not going to be included as \"owl:import\" to the mappings produces by the API,\nand all listed custom functions can be considered as templates." ;
        owl:versionIRI   avc:1.0 ;
        owl:versionInfo  "version 1.0" .

avc:hidden  a       owl:DatatypeProperty ;
        rdfs:range  xsd:string .

sp:abs  avc:hidden  "Duplicates the function fn:abs, which is preferable, since it has information about return types." .

sp:eq   avc:constraint  [ spl:predicate  sp:arg2 ;
                          spl:valueType  avc:undefined
                        ] ;
        avc:constraint  [ spl:predicate  sp:arg1 ;
                          spl:valueType  avc:undefined
                        ] .

avc:UUID  a                 spinmap:TargetFunction ;
        rdfs:comment        "A target function.\nGenerates an IRI from the UUID URN scheme based on source individual MD5 sum.\nEach call of AVC:UUID returns the same UUID IRI.\nExample: <urn:uuid:f3bf688d44e249fade9ca8ca23e29884>." ;
        rdfs:label          "MD5 UUID" ;
        rdfs:seeAlso        <https://www.w3.org/TR/sparql11-query/#func-uuid> , sp:UUID ;
        rdfs:subClassOf     spinmap:TargetFunctions ;
        spin:body           [ a                   sp:Select ;
                              sp:resultVariables  ( [ sp:expression  [ a        sp:iri ;
                                                                       sp:arg1  [ sp:varName  "uri" ]
                                                                     ] ;
                                                      sp:varName     "result"
                                                    ]
                                                  ) ;
                              sp:where            ( [ a              sp:Bind ;
                                                      sp:expression  [ a        sp:md5 ;
                                                                       sp:arg1  [ a        sp:str ;
                                                                                  sp:arg1  [ sp:varName  "source" ]
                                                                                ]
                                                                     ] ;
                                                      sp:variable    [ sp:varName  "value" ]
                                                    ]
                                                    [ a              sp:Bind ;
                                                      sp:expression  [ a        sp:concat ;
                                                                       sp:arg1  "urn:uuid:" ;
                                                                       sp:arg2  [ sp:varName  "value" ]
                                                                     ] ;
                                                      sp:variable    [ sp:varName  "uri" ]
                                                    ]
                                                  )
                            ] ;
        spin:returnType     rdfs:Resource ;
        spinmap:shortLabel  "UUID" .
